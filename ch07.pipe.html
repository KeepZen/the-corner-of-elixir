<!DOCTYPE HTML>
<html lang="zh-cn" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>ç®¡é“æ“ä½œç¬¦ - è§’è½é‡Œçš„é•¿ç”Ÿä¸è€è¯</title>
    <!-- Custom HTML head -->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="favicon.svg">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">
    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">
    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <!-- MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
    </script>
</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded "><a href="ch01.intruction.html"><strong aria-hidden="true">1.</strong> å‰è¨€</a></li><li class="chapter-item expanded "><a href="ch02.plus_and_minus.html"><strong aria-hidden="true">2.</strong> åŠ å’Œå‡</a></li><li class="chapter-item expanded "><a href="ch03.pattern_match.html"><strong aria-hidden="true">3.</strong> æ¨¡å¼åŒ¹é…</a></li><li class="chapter-item expanded "><a href="ch04.parenthese.html"><strong aria-hidden="true">4.</strong> æ‹¬å·</a></li><li class="chapter-item expanded "><a href="ch05.new_constructor.html"><strong aria-hidden="true">5.</strong> å®šåˆ¶æ–°ç»“æ„</a></li><li class="chapter-item expanded "><a href="ch06.async_programe.html"><strong aria-hidden="true">6.</strong> å¼‚æ­¥ç¼–ç¨‹</a></li><li class="chapter-item expanded "><a href="ch07.pipe.html" class="active"><strong aria-hidden="true">7.</strong> ç®¡é“æ“ä½œç¬¦</a></li><li class="chapter-item expanded "><a href="ch08.error_handle.html"><strong aria-hidden="true">8.</strong> é”™è¯¯å¤„ç†</a></li><li class="chapter-item expanded "><a href="ch09.module.html"><strong aria-hidden="true">9.</strong> æ¨¡å—</a></li><li class="chapter-item expanded "><a href="ch10.protocol_and_behaviour.html"><strong aria-hidden="true">10.</strong> åè®®ä¸è¡Œä¸º</a></li><li class="chapter-item expanded "><a href="ch11.macro.html"><strong aria-hidden="true">11.</strong> å¦‚ä½•ç†è§£å®</a></li><li class="chapter-item expanded "><a href="ch12.process.html"><strong aria-hidden="true">12.</strong> è¿›ç¨‹</a></li><li class="chapter-item expanded "><a href="chx.cold_knowledge.html"><strong aria-hidden="true">13.</strong> é™„å½• å†·çŸ¥è¯†</a></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
            <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">è§’è½é‡Œçš„é•¿ç”Ÿä¸è€è¯</h1>

                <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>
            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <h1 id="ç¬¬ä¸ƒç« -ç®¡é“æ“ä½œç¬¦"><a class="header" href="#ç¬¬ä¸ƒç« -ç®¡é“æ“ä½œç¬¦">ç¬¬ä¸ƒç«  ç®¡é“æ“ä½œç¬¦</a></h1>
<h2 id="ç®¡é“æ“ä½œç¬¦ä¸æ˜¯ç»„åˆå‡½æ•°"><a class="header" href="#ç®¡é“æ“ä½œç¬¦ä¸æ˜¯ç»„åˆå‡½æ•°">ç®¡é“æ“ä½œç¬¦ä¸æ˜¯ç»„åˆå‡½æ•°</a></h2>
<p>åœ¨å‡½æ•°å¼ç¼–ç¨‹çš„ç¤¾åŒºä¸­, å‡½æ•°ç»„åˆéå¸¸çš„é‡è¦. ç»„åˆå‡½æ•°æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°, å®ƒæ¥å—å¤šä¸ªå‡½æ•°,
è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°, ä¾‹å¦‚ <code>fun=compose(f,g,k)</code>, é‚£ä¹ˆ <code>fun(x,y,z)</code> å°±ç­‰ä»·äº
<code>f(g(k(x,y,z)))</code>. ä¸ºäº†ä¸æ€ç»´çš„ä¹ æƒ¯ä¸€è‡´, äººä»¬è¿˜å®šä¹‰äº†ååºçš„ç»„åˆå‡½æ•°, å«åš <code>pipe</code> å‡½æ•°.</p>
<p>åœ¨ Elixir ä¸­æ²¡æœ‰å†…ç½®çš„ <code>compose</code> æˆ– <code>pipe</code> å‡½æ•°, ä½†æ˜¯å†…ç½®äº†ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code>.
æˆ‘ä¸€åº¦è®¤ä¸ºç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> å°±æ˜¯ Elixir çš„ <code>pipe</code> å‡½æ•°. ä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªå¹»è§‰.
ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> æ›´åƒ shell çš„ç®¡é“è€Œä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ <code>pipe</code> å‡½æ•°.</p>
<p>è‡³å°‘ Elixir ç¼–è¯‘å™¨ä¸ä¼šä¸ºæˆ‘ä»¬åšå‡½æ•°ç»„åˆçš„ä¼˜åŒ–.</p>
<p>å‡½æ•°å¼ç¼–ç¨‹ä¸­, å¾ˆå¤šè¯­è¨€, ä¼šå¯¹å‡½å­çš„ map æ“ä½œåšä¼˜åŒ–. æ¯”å¦‚:
<code>[1,2,3].map(f).map(f2)</code> ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ä¸º <code>[1,2,3].map(compse(f,f2))</code>,
ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡.</p>
<p>åœ¨ Elixir ä¸­, ç›¸åº”çš„ä»£ç æ˜¯è¿™æ ·çš„: <code>[1,2,3] |&gt; Enum.map(f)|&gt; Enum.map(f2)</code>.
è¿™æ ·çš„ä»£ç , å¦‚æœæœ‰ä¼˜åŒ–çš„, æœ€ååº”è¯¥ç­‰ä»·äº <code>[1,2,3]|&gt; Enum.map(&amp;f2.(f.(&amp;1)))</code>.
ä½†æ˜¯å®é™…çš„æƒ…å†µå¹¶ä¸æ˜¯è¿™æ ·çš„.</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç :</p>
<pre><code class="language-elixir">fun1 = fn v -&gt; v |&gt; IO.inspect(label: &quot;+1&quot;) |&gt; then(&amp;(&amp;1 + 1)) end
fun2 = fn v -&gt; v |&gt; IO.inspect(label: &quot;-1&quot;) |&gt; then(&amp;(&amp;1 - 1)) end
range = 1..5

range
|&gt; Enum.map(fun1)
|&gt; Enum.map(fun2)
|&gt; IO.inspect(label: &quot;result of map chain&quot;)
</code></pre>
<p>æ§åˆ¶å°çš„è¾“å‡ºä¸º:</p>
<pre><code>+1: 1
+1: 2
+1: 3
+1: 4
+1: 5
-1: 2
-1: 3
-1: 4
-1: 5
-1: 6
result of map chain: [1, 2, 3, 4, 5]
</code></pre>
<p>ä»æ§åˆ¶å°çš„è¾“å‡ºä¸­, å¯ä»¥è§‚å¯Ÿåˆ°, æ‰€æœ‰çš„ <code>+1</code> è¾“å‡ºç»“æŸå, æ‰å¼€å§‹ <code>-1</code> çš„è¾“å‡º.
ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> è¿æ¥èµ·æ¥çš„å¤šä¸ª <code>Enum.map</code> å¹¶æ²¡æœ‰è¢«åˆå¹¶ä¸ºä¸€ä¸ª.
åªæœ‰å¯¹ <code>fun1</code> çš„è¿­ä»£å…¨éƒ¨å®Œæˆå, å¯¹ <code>fun2</code> è°ƒç”¨æ‰å¼€å§‹æ‰§è¡Œ.
ä½†å¦‚æœæŠŠ <code>fun2</code> å’Œ <code>fun1</code> ç»„åˆæˆä¸€ä¸ªæ–°çš„å‡½æ•°, åƒä¸‹é¢çš„ä»£ç è¿™æ ·:</p>
<pre><code class="language-elixir">range
|&gt; Enum.map(&amp;fun2.(fun1.(&amp;1)))
|&gt; IO.inspect(label: &quot;result of compose&quot;)
</code></pre>
<p>é‚£ä¹ˆæ§åˆ¶å°çš„è¾“å‡ºåº”è¯¥æ˜¯ <code>+1</code> <code>-1</code> äº¤æ›¿å‡ºç°.</p>
<p>å› æ­¤å¯è§, Elixir å†…ç½®çš„ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> ä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ <code>pipe</code> å‡½æ•°.</p>
<p>å¯æ˜¯æ‰‹åŠ¨çš„ç»„åˆå‡½æ•°æ€»æ˜¯æ¯”è¾ƒçš„éº»çƒ¦, å†™ä¸€ä¸ªå‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆå‡½æ•°çš„ç»„åˆä¹Ÿä¸æ˜¯éš¾äº‹,
ä½†æ˜¯ Elixir ç¤¾åŒºä¸­, å› ä¸ºå‘½åå‡½æ•°ä¸æ˜¯ä¸€ç­‰å…¬æ°‘, æ‰€ä»¥å‡½æ•°ç»„åˆçš„è¯­æ³•å¹¶ä¸å¸¸ç”¨.
å¤§å®¶æœ€ä¹ æƒ¯çš„å…¶å®è¿˜æ˜¯ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code>, æ‰€ä»¥å¦‚æœç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> èƒ½å¯¹ <code>Enum.map</code>
åšä¼˜åŒ–, é‚£ä¹ˆåº”è¯¥èƒ½æå‡ä»£ç çš„è¿è¡Œæ•ˆç‡.</p>
<p>éå¸¸å¹¸è¿, ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> åœ¨ Elixir ä¸­å¹¶ä¸æ˜¯ç‰¹æ®Šè¡¨å•, å› æ­¤å¯ä»¥å®šä¹‰è‡ªå·±çš„ç®¡é“æ“ä½œç¬¦
<code>|&gt;</code>.</p>
<p>Elixir æºç ä¸­å®šä¹‰çš„ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> å¯ä»¥ä½œä¸ºæˆ‘ä»¬å·¥ä½œçš„èµ·ç‚¹.
æˆ‘ä»¬å¯ä»¥åœ¨
<a href="https://github.com/elixir-lang/elixir/blob/9a4d10e702f33d2fa47718cde05375b506b4a3d6/lib/elixir/lib/kernel.ex#L4073"><code>kernel.ex</code></a>
ä¸­å‘ç°å…¶å®šä¹‰:</p>
<pre><code class="language-elixir">defmacro left |&gt; right do
  [{h, _} | t] = Macro.unpipe({:|&gt;, [], [left, right]})

  fun = fn {x, pos}, acc -&gt;
    Macro.pipe(acc, x, pos)
  end

  :lists.foldl(fun, h, t)
end
</code></pre>
<p>ä¸ç”¨ç‰¹åˆ«çš„ç†Ÿæ‚‰ Elixir çš„å®, åªéœ€è¦ç†è§£æœ€åçš„ <code>:lists.foldl/3</code>,
æˆ‘ä»¬å°±èƒ½å¤§æ¦‚ç†è§£ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> çš„åŸç†äº†, å…¶å®ä¸åœ¨ Javascript ä¸­å®šä¹‰
<code>pipe</code> å‡½æ•°çš„ç®—æ³•ä¸€æ ·.</p>
<p>ä¸Šé¢çš„ä»£ç ä¸­, <code>t</code> å°±æ˜¯ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> çš„æ‰€æœ‰çš„å³æ“ä½œæ•° (å‡½æ•°) ç»„æˆçš„åˆ—è¡¨,
ä¹Ÿå°±æ˜¯æ‰€æœ‰å¾…ç»„åˆçš„ <strong>å‡½æ•°è°ƒç”¨</strong> çš„åˆ—è¡¨.</p>
<p>æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> æ‰€ä½œçš„ä¼˜åŒ–, æœ¬è´¨å°±æ˜¯å¯¹å‡½æ•°è°ƒç”¨åˆ—è¡¨ <code>t</code> åˆå¹¶åŒç±»é¡¹.
å…·ä½“æ¥è¯´å°±æ˜¯, è¯†åˆ«è¿ç»­ç›¸é‚»çš„ <code>Enum.map(f1)</code>, <code>Enum.map(f2)</code> ...,<code>Enum.map(fn)</code>,
å¹¶æŠŠä»–ä»¬åˆå¹¶æˆä¸ºä¸€ä¸ª <code>Enum.map(composed_fun)</code>.</p>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>Optimizer</code> è¡Œä¸º, è¿™ä¸ªè¿™ä¸ªè¡Œä¸ºåªæœ‰ä¸€ä¸ªå‡½æ•°, å°±æ˜¯ä¼˜åŒ–å‡½æ•°:
<code>optimize(t,list)</code>.</p>
<p>æ‰€ä»¥å¦‚æ­¤, æ˜¯å› ä¸º, è™½ç„¶ç°åœ¨æˆ‘ä»¬åªæ˜¯å®Œæˆ <code>Enum.map/2</code> ç›¸å…³çš„å®ç°,
ä½†æ˜¯å¯¹äºç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> çš„å³æ“ä½œæ•°, å¦‚æœå°†æ¥å‘ç°, é™¤ <code>Enum.map/2</code> ç»„æˆçš„é“¾æ¡å¤–,
è¿˜æœ‰å…¶ä»–çš„æƒ…å½¢å¯ä»¥ä¼˜åŒ–, é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å¯¹æ–°æƒ…å½¢å®ç° <code>Optimizer</code> è¡Œä¸ºå°±å¥½äº†.</p>
<p>å®šä¹‰ <code>Optimizer</code> è¡Œä¸º, è®©æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“ç»„ç»‡.</p>
<h2 id="ä¼˜åŒ–å™¨åè®®"><a class="header" href="#ä¼˜åŒ–å™¨åè®®">ä¼˜åŒ–å™¨åè®®</a></h2>
<pre><code class="language-elixir">defmodule Optimizer do
  @callback optimize(t :: any, ast_list :: List.t()) :: List.t()

  defmacro __using__(_opts) do
    quote do
      import Kernel, except: [|&gt;: 2]
      import Optimizer.Pipe, only: [|&gt;: 2]
    end
  end
end
</code></pre>
<p>ç¬¬ 2 è¡Œæˆ‘ä»¬å®šä¹‰äº†ä¼˜åŒ–å™¨çš„æ¥å£.
è€Œ <code>__using__/1</code> çš„å®šä¹‰å¯ä»¥çœ‹ä½œæ˜¯ä¼˜åŒ–å™¨å¯¹å¤–æä¾›çš„ API.
ä¼˜åŒ–å™¨çš„ä½¿ç”¨è€…, åªéœ€è¦ <code>use Optimizer</code> å°±å¯ä»¥äº†ä½¿ç”¨ä¼˜åŒ–å™¨äº†,
ä¸ç”¨å…³å¿ƒä¼˜åŒ–å™¨å†…éƒ¨çš„å®ç°.</p>
<h2 id="å¯¹-enummap-ä¼˜åŒ–"><a class="header" href="#å¯¹-enummap-ä¼˜åŒ–">å¯¹ Enum.map ä¼˜åŒ–</a></h2>
<p>ç°åœ¨è®©æˆ‘ä»¬æ¥å®šä¹‰é’ˆå¯¹ <code>Enum.map/2</code> çš„ä¼˜åŒ–.
æˆ‘æŠŠæœ‰å…³ä¼˜åŒ–çš„ä»£ç éƒ½æ”¾åœ¨ <code>optimizer</code> ç›®å½•ä¸‹,
ä¸º <code>Enum.map/2</code> åšä¼˜åŒ–çš„æ¨¡å—, å‘½åä¸º <code>Optimizer.EnumMap</code>.</p>
<p>åƒæˆ‘ä»¬ä¸Šé¢åˆ†æçš„é‚£æ ·, <code>Optimizer.EnumMap</code> è¦åšçš„äº‹æƒ…, å°±æ˜¯æŠŠç”±ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code>,
é“¾æ¥èµ·æ¥çš„è¿ç»­çš„å¤šä¸ª <code>Enum.map(fun)</code> è¡¨è¾¾å¼åˆå¹¶ä¸ºä¸€ä¸ª <code>Enum.map(funs)</code>.
è¿™é‡Œç”± <code>reduce_map/1</code> å‡½æ•°å®Œæˆå…·ä½“çš„å·¥ä½œ. <code>reduce_map</code> å‡½æ•°åˆ†ä¸¤æ­¥å®Œæˆå·¥ä½œ:</p>
<ol>
<li>å¯¹æ‰€æœ‰å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼è¿›è¡Œåˆ†ç»„, è¿ç»­çš„ <code>Enum.map(fun)</code> è¡¨è¾¾å¼åˆ†ä¸ºä¸€ç»„,
å…¶ä»–çš„è¡¨è¾¾å¼, å•ç‹¬ä¸ºä¸€ç»„. ç”± <code>group_function_calls/1</code> å®Œæˆ.</li>
<li>æŠŠåˆ†ç»„åçš„ <code>Enum.map(fun)</code> è¡¨è¾¾å¼æŠ½è±¡è¯­æ³•æ ‘, 
åˆå¹¶ä¸ºä¸€ä¸ª <code>Enum.map(composed_fun)</code>. ç”± <code>tranceform_group/1</code>.</li>
</ol>
<pre><code class="language-elixir">defmodule Corner.Optimizer.EnumMap do
  alias Corner.Optimizer
  @behaviour Optimizer

  @impl Optimizer
  def optimize(__MODULE__, list) do
    reduce_map(list)
  end

  defp reduce_map(ast_list) do
    ast_list
    |&gt; group_function_calls()
    |&gt; Enum.map(&amp;tranceform_group/1)
  end
  #...
end
</code></pre>
<p><code>group_function_calls</code> å°±æ˜¯å¯¹å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„æŠ½è±¡è¯­æ³•æ ‘åˆ—è¡¨åšè¿­ä»£.
å¯¹äºå‡½æ•°è°ƒç”¨ <code>fun_call</code>, å¦‚æœå®ƒæ˜¯ <code>Enum.map(fun)</code> çš„æŠ½è±¡è¯­æ³•æ ‘,
é‚£ä¹ˆå®ƒåº”è¯¥å°±æ˜¯è¢«åˆ†ç»„çš„å†…å®¹, é¦–å…ˆæŠŠå®ƒä½¿ç”¨åˆ—è¡¨åŒ…è£¹, ä»¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåˆ†ç»„,
ç„¶åæŠŠåˆ—è¡¨æ·»åŠ åˆ°æ±‡èšç»“æœ <code>acc</code> çš„å¤´éƒ¨.
å¦‚æœå®ƒä¸æ˜¯ <code>Enum.map(fun)</code>, é‚£ä¹ˆç›´æ¥åŠ å…¥åˆ° <code>acc</code> å¤´éƒ¨å°±å¥½äº†.</p>
<p>å½“æ±‡èšç»“æœ <code>acc</code> å…¶ä¸­ç”±å†…å®¹äº†, å¾…æ£€æŸ¥çš„ <code>fun</code> ç¬¦åˆè¦æ±‚, 
è€Œä¸”æ±‡èšç»“æœçš„æœ€åä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåˆ—è¡¨è¯, é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç»§ç»­å‘åˆ—è¡¨ä¸­æ·»åŠ æ–°çš„å…ƒç´ .
å¦‚æœæ±‡èšç»“æœçš„æœ€åä¸€ä¸ªå…ƒç´ ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨. é‚£ä¹ˆéœ€è¦å‘æ±‡èšç»“æœä¸­æ·»åŠ æ–°çš„åˆ†ç»„åˆ—è¡¨.</p>
<p>å½“ <code>fun</code> ä¸æ˜¯ <code>Enum.map(fun)</code> çš„æ—¶å€™, åªè¦æŠŠ <code>fun</code> æ·»åŠ åˆ°æ±‡èšç»“æœä¸­, å°±å¯ä»¥äº†.</p>
<p>è¿™æ ·æ“ä½œå, å‡½æ•°è°ƒç”¨çš„é¡ºåºå…¨éƒ¨é¢ å€’äº†, æ‰€ä»¥ä½¿ç”¨ <code>Enum.reverse/1</code>
å¯¹å‡½æ•°è°ƒç”¨åˆ—è¡¨å®Œæˆé‡æ’. </p>
<pre><code class="language-elixir">defp group_function_calls(fun_call_list) do
  for fun_call &lt;- fun_call_list, reduce: [] do
    [] = acc -&gt;
      if is_map_call(fun_call) do
        [[fun_call] | acc]
      else
        [fun_call | acc]
      end
    [ele | rest] = acc -&gt;
      fun_is_map? = is_map_call(fun_call)
      cond do
        fun_is_map? and is_list(ele) -&gt;
          [[fun_call | ele] | rest]
        fun_is_map? -&gt;
          [[fun_call] | acc]
        true -&gt;
          [fun_call | acc]
      end
  end
  |&gt; Enum.reverse()
end
</code></pre>
<p><code>is_map_call/1</code> ç”¨æ¥æ£€æŸ¥æŠ½è±¡è¯­æ³•æ ‘æ˜¯å¦å¯¹åº”è¡¨è¾¾å¼ <code>Enum.map(fun)</code>.</p>
<pre><code class="language-elixir">defp is_map_call({{{:., _, [{:__aliases__, _, [:Enum]}, :map]}, _, _}, 0}),
  do: true
defp is_map_call(_), do: false
</code></pre>
<p><code>tranceform_group/1</code> æŠŠåˆ†ç»„çš„ <code>Enum.map(fun)</code> åˆå¹¶ä¸ºä¸€ä¸ª
<code>Enum.map(composed_fun)</code>.
è¿™ä¹Ÿæ˜¯åˆ†ä¸‰æ­¥å®Œæˆ, ç¬¬ä¸€æ­¥æå– <code>Enum.map(fun)</code> è¡¨è¾¾å¼ä¸­çš„ <code>fun</code>.
è¿™ç”± <code>get_fun/1</code> å‡½æ•°å®Œæˆ.
ç¬¬äºŒä¸ªæ­¥ç»„åˆæå–å‡½æ•°. æœ€åä¸€æ­¥æŠŠç»„åˆå‡½æ•° <code>composed_fun</code> è½¬ä¸ºä¸º
<code>Enum.map(composed_fun)</code>. </p>
<p>å…¶ä»–é <code>Enum.map(fun)</code> çš„å‡½æ•°è°ƒç”¨, ä¸åšå¤„ç†ç›´æ¥è¿”å›.</p>
<pre><code class="language-elixir">defp tranceform_group(map_calls) when is_list(map_calls) do
  composed_fun =
    map_calls
    |&gt; Enum.map(&amp;get_fun/1)
    |&gt; compose()

  {{{:., [], [{:__aliases__, [], [:Enum]}, :map]}, [], 
   [composed_fun]}, 
   0}
end
defp tranceform_group(other_ast), do: other_ast
</code></pre>
<p><code>get_fun/1</code> å‡½æ•°éå¸¸ç®€å•, æˆ‘ä»¬åªæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…æ¥æå–æˆ‘ä»¬éœ€è¦çš„å°±å¯ä»¥äº†.</p>
<pre><code class="language-elixir">defp get_fun(
       {{
          {:., _, [{:__aliases__, [], [:Enum]}, :map]},
          _,
          [fun]
        }, 0}
     ) do
  fun
end
</code></pre>
<p>æœ€åæ˜¯ç»„åˆå‡½æ•°. <code>compose/1-2</code>.</p>
<pre><code class="language-elixir">defp compose(list, acc \\ nil)

defp compose([fun | funs], nil) do
  acc =
    quote do
      unquote(fun).()
    end
  compose(funs, acc)
end

defp compose([fun | funs], acc) do
  acc =
    quote do
      unquote(fun).() |&gt; unquote(acc)
    end
  compose(funs, acc)
end

defp compose([], acc) do
  quote do
    fn v -&gt; v |&gt; unquote(acc) end
  end
end
</code></pre>
<p>åˆ†ç»„åå‡½æ•°çš„åˆ—è¡¨çš„é¡ºåºä¸å®ƒä»¬åœ¨ç®¡é“æ“ä½œç¬¦ä¸­å‡ºç°çš„é¡ºåºå·²ç»å®Œæˆäº†åè½¬.
å¯¹ä¸åˆ—è¡¨ <code>[fun_n, ... fun_2, fun_1]</code>. è¿™é‡Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯ä¸€å…ƒå‡½æ•°.
æœ€ç»ˆè¦è½¬åŒ–ä¸º <code>fn v -&gt; v |&gt; fun_1.() |&gt; fun_2.() |&gt; ... |&gt; fun_n.() end</code>.
ç¬¬ä¸€ä¸ªåˆ†å¥å®Œæˆ, æœ€å <code>fun_n.()</code>, ç¬¬äºŒä¸ªåˆ†å¥å®Œæˆ
<code>fun_1.() |&gt; fun_2.() ..|&gt; fun_n.()</code>.
è€Œæœ€åä¸€ä¸ªæ•°æ®å®Œæˆ <code>fn -&gt; v |&gt; ... end</code> çš„æ“ä½œ.</p>
<p>å‰é¢è¯´è¿‡, è¦è‡ªå®šä¹‰ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code>, ç°åœ¨æ˜¯å…‘ç°çš„æ—¶å€™äº†.</p>
<h2 id="ç®¡é“æ“ä½œç¬¦"><a class="header" href="#ç®¡é“æ“ä½œç¬¦">ç®¡é“æ“ä½œç¬¦</a></h2>
<pre><code class="language-elixir">defmodule Corner.Optimizer.Pipe do
  import Kernel, except: [|&gt;: 2]
  alias Corner.Optimizer.{EnumMap}
  @optimizer [EnumMap]
  defmacro left |&gt; right do
    [{h, _} | t] = Macro.unpipe({:|&gt;, [], [left, right]})

    fun = fn {x, pos}, acc -&gt;
      Macro.pipe(acc, x, pos)
    end

    t = Enum.reduce(@optimizer, t, &amp;apply(&amp;1, :optimize, [&amp;1, &amp;2]))
    :lists.foldl(fun, h, t)
  end
end
</code></pre>
<p>å½“å®šä¹‰äº†æ›´å¤šçš„ä¼˜åŒ–å™¨çš„æ—¶å€™, åªéœ€è¦ä¿®æ”¹ä¸Šé¢ä»£ç çš„ç¬¬ 3, 4 ä¸¤è¡Œä»£ç , å°±å¯ä»¥äº†.</p>
<p>ä¸Šé¢çš„ä»£ç , å¤§éƒ¨åˆ†éƒ½æ˜¯ç…§æ¬ Elixir çš„ Kernel æ¨¡å—ä¸­ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> çš„å®šä¹‰,
åªæ˜¯å¢åŠ äº†ç¬¬ 12 è¡Œçš„å†…å®¹, è€Œå®ƒåšçš„å·¥ä½œ, ä¾æ¬¡çš„è°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„ä¼˜åŒ–å™¨.</p>
<p>ç°åœ¨æ¥çœ‹çœ‹, ä»£ç æ˜¯ä¸èƒ½æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸå·¥ä½œ:</p>
<pre><code class="language-elixir">use Corner.Optimizer
add_one = fn v -&gt;
  IO.puts(&quot;+1&quot;)
  v + 1
end

sub_one = fn v -&gt;
  IO.puts(&quot;-1&quot;)
  v - 1
end

1..5
|&gt; Enum.map(add_one)
|&gt; Enum.map(sub_one)
|&gt; IO.inspect(label: &quot;after optimizer&quot;)
</code></pre>
<p>æ§åˆ¶å°ä¸­è¾“å‡ºä¸º:</p>
<pre><code>+1
-1
+1
-1
+1
-1
+1
-1
+1
-1
after optimizer: [1, 2, 3, 4, 5]
</code></pre>
<h2 id="åŸºå‡†æµ‹è¯•"><a class="header" href="#åŸºå‡†æµ‹è¯•">åŸºå‡†æµ‹è¯•</a></h2>
<p>çœ‹èµ·æ¥, åŠŸèƒ½æµ‹è¯•é€šè¿‡äº†, ä½†æ˜¯æˆ‘ä»¬æ¯•ç«Ÿæ˜¯åšä¼˜åŒ–çš„, æˆ‘ä»¬çš„ä»£ç çœŸçš„èƒ½æå‡ä»£ç çš„æ‰§è¡Œæ•ˆç‡å—?
è¿™è¿˜éœ€è¦å®é™…æµ‹è¯•çš„.</p>
<pre><code class="language-elixir">defmodule OptimizeBenchmarkTest do
  use ExUnit.Case, async: true
  @range 1..1000

  def fun1(up \\ 10) do
    for _ &lt;- 1..up do
      @range
      |&gt; Enum.map(&amp;(&amp;1 + 1))
      |&gt; Enum.map(&amp;(&amp;1 - 1))
    end
  end

  def fun2(up \\ 10) do
    use Corner.Optimizer

    for _ &lt;- 1..up do
      @range
      |&gt; Enum.map(&amp;(&amp;1 + 1))
      |&gt; Enum.map(&amp;(&amp;1 - 1))
    end
  end

  test &quot;Optimizer of |&gt; for Enum.map&quot; do
    arg = [10000]
    task1 = Task.async(fn -&gt; :timer.tc(&amp;fun1/1, arg) end)
    task2 = Task.async(fn -&gt; :timer.tc(&amp;fun2/1, arg) end)

    [{t, v}, {t1, v1}] = Task.await_many([task1, task2], 60_000)
    IO.puts(&quot;speed up #{(t - t1) / t1 * 100}%.&quot;)
    assert v == v1
  end
end
</code></pre>
<p>æœ€åˆ, æˆ‘æ˜¯ä½¿ç”¨ LiveBoook æ¥æ¢ç´¢ Elixir çš„.
åœ¨ LiveBook ä¸­, è¿è¡Œè¿™ä¸ªæµ‹è¯•çš„å, å…¶ä¸­æœ‰ä¸€æ¬¡, ä»£ç çš„è¾“å‡ºæ˜¯è¿™æ ·çš„:</p>
<blockquote>
<p>speed up -1.5641347109939043%.</p>
</blockquote>
<p>è¿™å°±å°´å°¬äº†ğŸ˜’. ä¼˜åŒ–åçš„ä»£ç ä¸æ˜¯æé€Ÿäº†, åè€Œå˜æ…¢äº† 1.5 ä¸ªç™¾åˆ†ç‚¹. å¯æ˜¯ä¸ºä»€ä¹ˆä¼šè¿™æ ·å•Š?</p>
<p>è¿™æ˜¯å› ä¸º LiveBook ä»£ç  Cell æœ¬è´¨ä¸Šæ˜¯è§£é‡Šæ‰§è¡Œçš„, å°±åƒä¸èƒ½ä»¥ä»£ç åœ¨ IEx
ä¸­çš„è¿è¡Œæ—¶é—´æ¥è¡¡é‡ä»£ç çš„æ•ˆç‡ä¸€æ ·, æˆ‘ä»¬ä¹Ÿä¸èƒ½ç”¨ LiveBook çš„ Cell 
ä¸­ä»£ç çš„æ‰§è¡Œæ—¶é—´æ¥è¡¡é‡ä»£ç çš„æ•ˆç‡.</p>
<p>è¿™ä¸ªä¼˜åŒ–çš„å®ç°, å…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å¤æ‚, ä¸ºä»€ä¹ˆ Elixir ç¼–è¯‘å™¨ä¸è¿™æ ·åšå‘¢?
è¿™é‡Œæœ‰ä¸¤ä¸ªåŸå› . ç¬¬ä¸€åŸå› , å°±æ˜¯ Elixir æ ‡å‡†åº“ä¸­æœ‰ <code>Stream</code> æ¨¡å—,
æ–‡æ¡£ä¸­, æ˜ç¡®æåˆ° <code>Stream.map</code> ä¼šç»„åˆå‡½æ•°çš„. 
ä¹Ÿå°±æ˜¯è¯´, Elixir æ˜¯ä»¥ <code>Stream.map</code> æ¥å®Œæˆå‡½æ•°ç»„åˆçš„å·¥ä½œçš„.</p>
<p>å¯¹äºä¸Šé¢çš„ç»„åˆä»£ç , ä½¿ç”¨ <code>Stream</code> æ›¿æ¢äº† <code>Enum</code>, å°±è·å¾—äº†ç›¸åŒçš„ç»“æœ.</p>
<pre><code class="language-elixir">1..5
|&gt; Stream.map(add_one)
|&gt; Stream.map(sub_one)
|&gt; Enum.to_list()
|&gt; IO.inspect(label: &quot;result of map chain&quot;)
</code></pre>
<p>æ‰€ä»¥, å½“æˆ‘çœ‹åˆ°æµ‹è¯•åœ¨ LiveBook æ•ˆç‡æ²¡æœ‰æå‡, ç”šè‡³è¿˜ä¸‹é™çš„æ—¶å€™,
æˆ‘ä¸€åº¦æ€€ç–‘, è‡ªå·±æ˜¯ä¸æ˜¯è§£å†³äº†ä¸€ä¸ªé”™è¯¯çš„é—®é¢˜?</p>
<p>ç­”æ¡ˆæ˜¯: ä¸æ˜¯çš„. è¿™ä¸ªå·¥ä½œä¾æ—§æ˜¯æœ‰æ„ä¹‰çš„.</p>
<p>å°±åƒä¸Šé¢å±•ç¤ºçš„é‚£æ ·, ç†è®ºä¸Šç»å¯¹ä¸æœ‰åº”è¯¥æ•ˆç‡ä¸‹é™çš„ä¼˜åŒ–åçš„ä»£ç , æµ‹è¯•çš„æ—¶å€™, 
æœ‰æ—¶å±…ç„¶ä¼šä¸‹é™ 1.5%. é‚£ä¹ˆ Stream ç‰ˆæœ¬å‘¢? ä¼šæ¯”æˆ‘ä»¬çš„çš„ä»£ç æ•ˆç‡æ›´é«˜å—?
æ€»æ˜¯ä¼˜ä¸å¤šä¸ª <code>Enum.map</code> ä¸²è”å—?</p>
<pre><code class="language-elixir">defmodule BenchmarkStreamTest do
  use ExUnit.Case, async: true
  @range 1..1000

  def fun1(up \\ 10) do
    for _ &lt;- 1..up do
      @range
      |&gt; Enum.map(&amp;(&amp;1 + 1))
      |&gt; Enum.map(&amp;(&amp;1 - 1))
    end
  end

  def fun2(up \\ 10) do
    for _ &lt;- 1..up do
      @range
      |&gt; Stream.map(&amp;(&amp;1 + 1))
      |&gt; Stream.map(&amp;(&amp;1 - 1))
      |&gt; Enum.to_list()
    end
  end

  test &quot;Enum.map vs Stream.map&quot; do
    arg = [10000]
    task1 = Task.async(fn -&gt; :timer.tc(&amp;fun1/1, arg) end)
    task2 = Task.async(fn -&gt; :timer.tc(&amp;fun2/1, arg) end)

    [{t, v}, {t1, v1}] = Task.await_many([task1, task2], 60_000)
    IO.puts(&quot;speed up #{(t - t1) / t * 100}%.&quot;)
    assert v == v1
  end
end
</code></pre>
<p>è¿™æ¬¡åœ¨ LiveBook ä¸­è¿è¡Œçš„ç»“æœæ›´åŠ ç³Ÿç³•, å’Œ <code>Enum.map</code> ç›¸æ¯”,
<code>Stream.map</code> ç‰ˆæœ¬çš„ä»£ç æ•ˆç‡ä¸‹é™äº† 100% è¿˜å¤š.</p>
<p>1%~2% çš„æ•ˆç‡å·®å¼‚æˆ‘ä»¬è¿˜èƒ½è§£é‡Šä¸ºä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­å¶ç„¶å› ç´ å¸¦æ¥çš„,
ä½† <code>Stream.map</code> å’Œ <code>Enum.map</code> çš„å·¨å¤§å·®å¼‚ç»å¯¹ä¸èƒ½å½’ç»“ä¸ºå¶ç„¶.
<code>Stream.map</code> è™½ç„¶å®Œæˆäº†çš„å‡½æ•°çš„ç»„åˆ, ä½†æ˜¯å´å¹¶æ²¡æœ‰æå‡æ•ˆç‡.</p>
<p>Elixir çš„ <code>Enum.map</code> ä¸ç»„åˆå‡½æ•°çš„ç¬¬äºŒä¸ªåŸå› æ˜¯, Elixir ä¸æ˜¯ä¸€ä¸ªçº¯çš„å‡½æ•°ç¼–ç¨‹è¯­è¨€.
ä¼ é€’ç»™ <code>Enum.map</code> çš„å‡½æ•°ä¸ä¿è¯æ²¡æœ‰å‰¯ä½œç”¨çš„. è€Œç†è®ºä¸Šæ¥è¯´,
åªæœ‰å½“ä¼ é€’ç»™ <code>Enum.map</code> çš„å‡½æ•°æ˜¯çº¯å‡½æ•°çš„æ—¶å€™, æ‰å¯ä»¥ç»„åˆå‡½æ•°.
ä½†æ˜¯è¦åœ¨ç¼–è¯‘æ—¶åˆ¤æ–­ä¸€ä¸ªå‡½æ•°ä¸­æ˜¯å¦æœ‰å‰¯ä½œç”¨, è¿™åŸºæœ¬ä¸Šåšä¸åˆ°,
æ‰€ä»¥ Elixir æ ‡å‡†åº“ä¸­çš„ç®¡é“æ“ä½œç¬¦ <code>|&gt;</code> å¹¶ä¸å¯¹ <code>Enum.map</code> åšå‡½æ•°çš„ç»„åˆ.</p>
<p>æˆ‘ä»¬çš„ä¼˜åŒ–å™¨, å¿½ç•¥äº†å‡½æ•°ä¸­çš„å‰¯ä½œç”¨è€Œå¼ºè¡Œå¯¹å‡½æ•°åšäº†ç»„åˆ.
æŠŠä¼˜åŒ–å™¨åšæµ‹è¯•çš„ä»£ç , ä¿å­˜åˆ°æ–‡ä»¶ä¸­, ä½¿ç”¨ <code>mix test</code> å‘½ä»¤æ¥é‡æ–°æµ‹è¯•, 
è¿™æ¬¡å‘ç°, ä½¿ç”¨ä¼˜åŒ–å™¨çš„ä»£ç , æ•ˆç‡æœ‰äº† 30%~40% çš„æ•ˆç‡æå‡.</p>
<p>æ‰‹åŠ¨ç»„åˆåŠŸèƒ½ä¸€æ ·çš„å‡½æ•°, å…¶æ•ˆç‡å’Œä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ä¼˜åŒ–å™¨çš„ä¸€æ ·.
åœ¨ä¸å¢åŠ å·¥ä½œé‡çš„æƒ…å†µä¸‹, æ•ˆç‡æå‡ 30%~40%, ä»è¿™ä¸ªè§’åº¦æ¥çœ‹, è¿™ä¸ªå·¥ä½œè¿˜æ˜¯ç®—æœ‰æ„ä¹‰å§?</p>

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="ch06.async_programe.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="ch08.error_handle.html" class="mobile-nav-chapters next"
                        title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="ch06.async_programe.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>
            <a rel="next" href="ch08.error_handle.html" class="nav-chapters next" title="Next chapter"
                aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>
    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
    <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="book.js" type="text/javascript" charset="utf-8"></script>

    <!-- Custom JS scripts -->
    <script type="text/javascript" src="theme/mermaid.min.js"></script>
    <script type="text/javascript" src="theme/mermaid-init.js"></script>
</body>

</html>